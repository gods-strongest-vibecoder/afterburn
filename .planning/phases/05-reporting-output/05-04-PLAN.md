---
phase: 05-reporting-output
plan: 04
type: execute
wave: 3
depends_on: ["05-02", "05-03"]
files_modified:
  - src/reports/index.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "Running afterburn <url> produces both HTML and Markdown reports in .afterburn/reports/"
    - "Report file paths are printed to terminal after generation"
    - "Pipeline runs: discovery -> execution -> analysis -> reporting -> exit"
    - "Reports generate even when analysis has zero issues (shows clean bill of health)"
    - "Report generation errors don't crash the pipeline (graceful degradation)"
  artifacts:
    - path: "src/reports/index.ts"
      provides: "Barrel exports for all report modules"
      exports: ["generateHtmlReport", "writeHtmlReport", "generateMarkdownReport", "writeMarkdownReport", "calculateHealthScore", "prioritizeIssues"]
    - path: "src/index.ts"
      provides: "Updated main entry point with report generation after analysis"
  key_links:
    - from: "src/index.ts"
      to: "src/reports/index.ts"
      via: "import for report generation functions"
      pattern: "import.*from.*reports"
    - from: "src/index.ts"
      to: "generateHtmlReport"
      via: "function call after analysis phase"
      pattern: "generateHtmlReport\\("
    - from: "src/index.ts"
      to: "generateMarkdownReport"
      via: "function call after analysis phase"
      pattern: "generateMarkdownReport\\("
---

<objective>
Wire report generation into the main pipeline and create barrel exports. After analysis completes, both HTML and Markdown reports are generated and saved to .afterburn/reports/.

Purpose: Completes Phase 5 by integrating reports into the pipeline so `afterburn <url>` produces reports.
Output: Updated src/index.ts with report generation, src/reports/index.ts barrel exports.
</objective>

<execution_context>
@C:\Users\Shiv_\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Shiv_\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-reporting-output/05-01-PLAN.md
@.planning/phases/05-reporting-output/05-02-PLAN.md
@.planning/phases/05-reporting-output/05-03-PLAN.md
@src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create barrel exports and integrate reports into pipeline</name>
  <files>src/reports/index.ts, src/index.ts</files>
  <action>
    1. Create `src/reports/index.ts` barrel file:
       ```typescript
       // Phase 5 Reporting & Output exports
       export * from './health-scorer.js';
       export * from './priority-ranker.js';
       export * from './html-generator.js';
       export * from './markdown-generator.js';
       ```

    2. Update `src/index.ts` to add report generation after analysis:

       Add import at top:
       ```typescript
       import { generateHtmlReport, writeHtmlReport, generateMarkdownReport, writeMarkdownReport } from './reports/index.js';
       ```

       After the analysis artifact is saved (after `await artifactStorage.save(analysisArtifact)` and its console.log), add the reporting phase:

       ```typescript
       // Phase 5: Generate reports
       console.log('Generating reports...\n');

       try {
         // Generate HTML report (human-readable)
         const htmlReport = await generateHtmlReport(executionResult, analysisArtifact);
         const htmlPath = `.afterburn/reports/report-${sessionId}.html`;
         await writeHtmlReport(htmlReport, htmlPath);

         // Generate Markdown report (AI-readable)
         const markdownReport = generateMarkdownReport(executionResult, analysisArtifact);
         const mdPath = `.afterburn/reports/report-${sessionId}.md`;
         await writeMarkdownReport(markdownReport, mdPath);

         console.log('Reports generated:');
         console.log(`  HTML (human): ${htmlPath}`);
         console.log(`  Markdown (AI): ${mdPath}`);
       } catch (reportError) {
         // Report generation should not crash the pipeline
         console.error('Warning: Report generation failed:', reportError instanceof Error ? reportError.message : String(reportError));
         console.error('Test results are still available in execution and analysis artifacts.');
       }

       console.log('');
       ```

       This block goes BEFORE `process.exit(executionResult.exitCode)`.

       Also update the comment at the top of the file:
       ```typescript
       // Main entry point with Phase 2 discovery + Phase 3 execution + Phase 4 analysis + Phase 5 reporting pipeline
       ```

    3. Verify the `generateMarkdownReport` call is synchronous (it returns a string, not a Promise).
       If the implementation in 05-03 made it async, adjust the call here to `await generateMarkdownReport(...)`.

    4. Also generate reports for the "no workflows" path. After the `else` branch that prints "No workflow plans to execute", add a minimal report:
       This is optional -- skip it since there's nothing to report when no workflows exist. The `process.exit(0)` there is sufficient.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify the full project compiles. Verify that the import from './reports/index.js' resolves correctly. Check that report generation is wrapped in try/catch.
  </verify>
  <done>
    src/reports/index.ts barrel file exports all report modules. src/index.ts generates both HTML and Markdown reports after analysis, with paths printed to terminal. Report generation errors are caught and logged without crashing the pipeline. Pipeline order: discovery -> execution -> analysis -> reporting -> exit.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build and verify end-to-end compilation</name>
  <files>src/reports/index.ts, src/index.ts</files>
  <action>
    1. Run full TypeScript build: `npm run build`
    2. Verify compiled output exists in `dist/reports/` directory:
       - dist/reports/health-scorer.js
       - dist/reports/priority-ranker.js
       - dist/reports/html-generator.js
       - dist/reports/markdown-generator.js
       - dist/reports/index.js
    3. Verify templates directory exists at project root: `templates/report.hbs` and `templates/styles/report.css`
    4. Fix any compilation errors discovered during build
    5. If template path resolution issues exist in html-generator.ts (path from dist/ to templates/), fix the relative path calculation
  </action>
  <verify>
    `npm run build` completes with exit code 0. All dist/reports/*.js files exist. No TypeScript errors.
  </verify>
  <done>
    Full project compiles without errors. All report modules produce valid JavaScript in dist/. Template paths resolve correctly from compiled output location. Pipeline is ready for end-to-end testing.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. src/reports/index.ts exists with all barrel exports
3. src/index.ts imports from './reports/index.js' and calls generateHtmlReport + generateMarkdownReport
4. Report generation is wrapped in try/catch (doesn't crash pipeline)
5. Report paths are printed to terminal
6. dist/reports/ contains compiled JS files
7. Template files exist at templates/report.hbs and templates/styles/report.css
</verification>

<success_criteria>
- afterburn <url> generates both HTML and Markdown reports after analysis
- Reports saved to .afterburn/reports/report-{sessionId}.html and .md
- Report file paths printed to terminal
- Pipeline order preserved: discovery -> execution -> analysis -> reporting -> exit
- Report generation failure doesn't crash the pipeline (graceful try/catch)
- Full project compiles with npm run build
</success_criteria>

<output>
After completion, create `.planning/phases/05-reporting-output/05-04-SUMMARY.md`
</output>
