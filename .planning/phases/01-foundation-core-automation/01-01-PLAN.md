---
phase: 01-foundation-core-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - .gitignore
  - src/types/artifacts.ts
  - src/types/index.ts
autonomous: true

must_haves:
  truths:
    - "TypeScript project compiles without errors"
    - "All required dependencies are installed and importable"
    - "Shared types exist for all pipeline artifacts"
  artifacts:
    - path: "package.json"
      provides: "Project metadata and dependency manifest"
      contains: "playwright-extra"
    - path: "tsconfig.json"
      provides: "TypeScript compiler configuration"
      contains: "compilerOptions"
    - path: "src/types/artifacts.ts"
      provides: "Shared artifact type definitions for all pipeline stages"
      exports: ["ArtifactMetadata", "ScreenshotRef", "SessionConfig"]
    - path: "src/types/index.ts"
      provides: "Barrel export for all types"
  key_links:
    - from: "tsconfig.json"
      to: "src/"
      via: "include and paths configuration"
      pattern: "\"include\".*\"src\""
    - from: "package.json"
      to: "src/index.ts"
      via: "main entry point"
      pattern: "\"main\""
---

<objective>
Initialize the Afterburn TypeScript project with all dependencies, compiler configuration, and shared type definitions that downstream plans depend on.

Purpose: Every other plan in Phase 1 imports types and uses libraries installed here. This is the foundation everything builds on.
Output: A compilable TypeScript project with all Phase 1 dependencies installed and shared types defined.
</objective>

<execution_context>
@C:\Users\Shiv_\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Shiv_\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-core-automation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize TypeScript project with all Phase 1 dependencies</name>
  <files>
    package.json
    tsconfig.json
    .gitignore
  </files>
  <action>
    1. Run `npm init -y` to create package.json. Update it with:
       - name: "afterburn"
       - version: "0.1.0"
       - description: "Automated testing for vibe-coded websites"
       - main: "dist/index.js"
       - type: "module" (ESM)
       - scripts: { "build": "tsc", "dev": "tsx src/index.ts", "start": "node dist/index.js" }
       - bin: { "afterburn": "dist/index.js" }
       - license: "MIT"

    2. Install production dependencies:
       ```
       npm install playwright-extra playwright-extra-plugin-stealth sharp ora chalk fs-extra commander
       ```
       Use commander (not custom arg parsing) for CLI -- standard for Node.js CLIs.

    3. Install dev dependencies:
       ```
       npm install -D typescript tsx @types/node @types/fs-extra
       ```

    4. Create tsconfig.json:
       - target: "ES2022"
       - module: "NodeNext"
       - moduleResolution: "NodeNext"
       - outDir: "dist"
       - rootDir: "src"
       - strict: true
       - esModuleInterop: true
       - resolveJsonModule: true
       - declaration: true
       - sourceMap: true
       - include: ["src"]
       - exclude: ["node_modules", "dist"]

    5. Update .gitignore to include:
       - node_modules/
       - dist/
       - .afterburn/
       - *.tsbuildinfo

    Do NOT install @playwright/browser-chromium separately -- playwright-extra handles this.
    Do NOT use CommonJS (require) -- use ESM imports throughout.
  </action>
  <verify>
    - `npx tsc --noEmit` exits with code 0 (no type errors, even with empty src)
    - `node -e "import('playwright-extra').then(() => console.log('ok'))"` prints "ok"
    - package.json contains all expected dependencies
  </verify>
  <done>
    package.json has all deps, tsconfig.json compiles cleanly, .gitignore covers artifacts and build output.
  </done>
</task>

<task type="auto">
  <name>Task 2: Define shared type definitions for the entire pipeline</name>
  <files>
    src/types/artifacts.ts
    src/types/index.ts
  </files>
  <action>
    Create src/types/artifacts.ts with these TypeScript interfaces (from RESEARCH.md patterns):

    1. **ArtifactMetadata** -- base interface for all artifacts:
       - version: string (schema version, e.g. "1.0")
       - stage: string (pipeline stage name)
       - timestamp: string (ISO 8601)
       - sessionId: string (UUID)

    2. **ScreenshotRef** -- reference to a captured screenshot:
       - id: string (content hash, first 12 chars of SHA-256)
       - name: string (human-readable name)
       - pngPath: string (lossless path for LLM analysis)
       - webpPath: string (compressed path for display)
       - width: number
       - height: number
       - sizes: { png: number; webp: number; reduction: string }
       - capturedAt: string (ISO 8601)

    3. **CookieBannerSelector** -- cookie consent platform definition:
       - name: string
       - acceptButton: string (CSS selector)
       - rejectButton?: string
       - modal?: string

    4. **SessionConfig** -- configuration for a single run:
       - sessionId: string
       - targetUrl: string
       - startedAt: string
       - artifactDir: string (defaults to .afterburn/artifacts)
       - screenshotDir: string (defaults to .afterburn/screenshots)

    5. **BrowserConfig** -- browser launch configuration:
       - headless: boolean (default true)
       - userAgent: string
       - viewport: { width: number; height: number }
       - locale: string
       - timezoneId: string

    Create src/types/index.ts as barrel export:
    ```typescript
    export * from './artifacts.js';
    ```

    Note: Use .js extension in imports (required for NodeNext module resolution with ESM).
    Do NOT use enums -- use union string literal types instead (better tree-shaking, simpler).
  </action>
  <verify>
    - `npx tsc --noEmit` exits with code 0
    - All 5 interfaces are exported and importable: `import { ArtifactMetadata, ScreenshotRef, CookieBannerSelector, SessionConfig, BrowserConfig } from './types/index.js'`
  </verify>
  <done>
    All shared types are defined, exported, and compile without errors. Other plans can import from src/types/index.js.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `npm ls` shows all expected dependencies installed
- src/types/artifacts.ts exports at least 5 interfaces
- .gitignore includes .afterburn/ and dist/
</verification>

<success_criteria>
- TypeScript project compiles cleanly
- All Phase 1 libraries installed (playwright-extra, stealth plugin, sharp, ora, chalk, fs-extra, commander)
- Shared types defined for artifacts, screenshots, cookies, sessions, and browser config
- Project structure follows ESM conventions with NodeNext resolution
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-automation/01-01-SUMMARY.md`
</output>
